<!DOCTYPE html>
<html lang="en">
<script src="/js/lunr.min.js"></script><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter | Consdata - blog techniczny</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter" />
<meta name="author" content="jwilczewski" />
<meta property="og:locale" content="pl" />
<meta name="description" content="Optymalizatory zapytań" />
<meta property="og:description" content="Optymalizatory zapytań" />
<link rel="canonical" href="https://blog.consdata.tech/en/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html" />
<meta property="og:url" content="https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html" />
<meta property="og:site_name" content="Consdata - blog techniczny" />
<meta property="og:image" content="https://blog.consdata.tech/assets/img/posts/2023-10-24-jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu/mongodb.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-24T02:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.consdata.tech/assets/img/posts/2023-10-24-jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu/mongodb.webp" />
<meta property="twitter:title" content="Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"jwilczewski"},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html"},"description":"Optymalizatory zapytań","url":"https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html","image":"https://blog.consdata.tech/assets/img/posts/2023-10-24-jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu/mongodb.webp","headline":"Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter","dateModified":"2023-10-24T02:00:00-05:00","datePublished":"2023-10-24T02:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,700,600,500,300,200,100,800,900" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,600,500,300,200,100,800,900" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;400;500;700&display=swap" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.consdata.tech/en/feed.xml" title="Consdata - blog techniczny" /><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NFV6DPR');</script>


  <link rel="icon" type="image/x-icon" href="/en/favicon.ico">
</head>
<body>---
---
<nav class="site-header">
    <div class="container">
        <div class="header navbar-default" role="navigation">
            <div class="header-brand">
                <div class="nav navbar-nav">
                    <div class="nav-link"><a href="/en/">BLOG.CONSDATA.TECH</a></div>
                </div>

                <div class="mobile-search">
                    
<form action="/en/search.html" method="get">

    <div class="search-input-container">
        <input type="text" placeholder="Search..." id="search-box-mobile" name="query" class="search-input" autocomplete="off">
        <i class="fa fa-search search-icon" onclick="expandInputMobile()"></i>
    </div>
</form>

<script>
    const inputMobile = document.getElementById("search-box-mobile");
    const logo = document.getElementById("header-logo");
    const expandInputMobile = () => {
        inputMobile.classList.toggle("expanded");
        logo.classList.toggle("header-logo");
        logo.classList.toggle("logo-invisible");
    };
</script>

                </div>
            </div>
            <div id="header-links" class="mobile-nav">
                <a class="header-logo" href="https://consdata.com/pl">
                    <img src="/assets/img/logo-nowe.png" alt="consdata.com">
                </a>
                <div class="feed-subscribe">
                    <a href="/en/feed.xml">
                    <svg class="svg-icon">
                        <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
                    </svg>
                    </a>
                </div>
                
            </div>

        </div>
    </div>
</nav>
<script>
    function navigate(baseUrl) {
        const queryParams = window.location.search;
        window.location.href = baseUrl + queryParams;
    }
</script>





<div class="navigation-bar">
    <div class="row">
        <div class="col-15 desktop-navbar">
            <div class="col-2-3 navbar-links">
                <div class="navigation-tags">
                    
                        
                        <a href="/en/">
                        
                        PROGRAMMING
                        </a>
                    
                        
                        <a href="/en/">
                        
                        SERVERLESS
                        </a>
                    
                        
                        <a href="/en/">
                        
                        MONGODB
                        </a>
                    
                        
                        <a href="/en/">
                        
                        GCP
                        </a>
                    
                        
                        <a href="/en/">
                        
                        FRONTEND
                        </a>
                    
                </div>
                
<form action="/en/search.html" method="get">

    <div class="search-input-container">
        <input type="text" placeholder="Search..." id="search-box" name="query" class="search-input" autocomplete="off">
        <i class="fa fa-search search-icon" onclick="expandInputDesktop()"></i>
    </div>
</form>

<script>
    const inputDesktop = document.getElementById("search-box");
    const expandInputDesktop = () => {
        inputDesktop.classList.toggle("expanded");
    };
</script>

            </div>
            <div class="col-1-3">
                <a href="https://app2.salesmanago.pl/mscf/e7yrrpjmxbm7bahc/default/Landing_page_newsletter_techniczny.htm"
                   class="newsletter-link">
                    <div class="newsletter-button">
                        Sign up for a tech newsletter
                    </div>
                </a>
            </div>
        </div>
        <div class="col-15 mobile-navbar">
            <div class="navigation-tags">
                
                
                <a href="/en/">
                    
                        PROGRAMMING
                    </a>
                    
                
                <a href="/en/">
                    
                        SERVERLESS
                    </a>
                    
                
                <a href="/en/">
                    
                        MONGODB
                    </a>
                    
                
                <a href="/en/">
                    
                        GCP
                    </a>
                    
                
                <a href="/en/">
                    
                        FRONTEND
                    </a>
                    
            </div>
            <a href="https://app2.salesmanago.pl/mscf/e7yrrpjmxbm7bahc/default/Landing_page_newsletter_techniczny.htm"
               class="newsletter-link">
                <div class="newsletter-button">Sign up for a tech newsletter</div>
            </a>
        </div>
    </div>
</div>
<main class="page-content" aria-label="Content">
    


<div class="blog">
    <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
        <header>
            <div class="row back-link-row">
    <div class="col-15">
        <a href="/en/" class="main-page-link-container">
            <i class="fa fa-arrow-left"></i>
                All posts
        </a>
    </div>
</div>

            <div class="row">
                <div class="col-15">
                    <h1 class="post-big-title p-name" itemprop="name headline">Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-15">
                    <div class="post-metadata">

    <a href="/en/authors/jwilczewski.html" class="author-name">
        <img class="big-author-image" src="/assets/img/authors/jwilczewski.jpg" alt="author"></a>
    <div class="post-info"><a href="/en/authors/jwilczewski.html" class="author-name-metadata">Jakub Wilczewski</a>
        <span>
24

października



2023
</span>
    </div>


</div>

                </div>
                <div class="col-5">
                    

                </div>
            </div>
        </header>
        <div itemprop="articleBody" class="post-content-container">
            <div class="post-content-left-pane">
                <div class="post-content">
                    <div class=" post-highlight-image">
                        <img src="/assets/img/posts/2023-10-24-jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu/mongodb.webp" alt="postimage"/>
                    </div>
                    <div class="social-media-sharing">
                        <div id="share-bar">
    <div class="share-buttons">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html"
           onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
           title="Podziel się na Facebooku">
            <i class="fa fa-facebook-official share-button"></i>
        </a>

        <a href="https://twitter.com/intent/tweet?text=Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter&url=https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html"
           onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
           title="Podziel się na Twitterze">
            <i class="fa fa-twitter share-button"> </i>
        </a>

        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html&title=Jak zmusić MongoDB do użycia indeksu bez zmiany kodu - zastosowanie index filter&source=Consdata - blog techniczny"
           onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
           title="Podziel się na LinkedIn">
            <i class="fa fa-linkedin share-button"></i>
        </a>

    </div>

</div>

                    </div>
                    <div id="myModal" class="modal">
                        <i id="modal-close" class="fa fa-times close" aria-hidden="true"
                           onclick="closeModal()"></i>
                        <img class="modal-content">
                    </div>
                    <h2 id="optymalizatory-zapytań">Optymalizatory zapytań</h2>

<p>Optymalizator zapytań to element silnika bazy danych, który dba o to, aby zapytanie zostało wykonane w optymalny sposób, uwzględniając zbiór danych przechowywanych w danym momencie w bazie. Pod pojęciem optymalny mamy zazwyczaj na myśli taki sposób, który zwróci nam wynik zapytania w najkrótszym czasie. Optymalizator bierze pod uwagę statystyki gromadzone i aktualizowane na bieżąco podczas działania bazy danych. Optymalizatory są wbudowane zarówno w bazy SQL’owe jak i bazy NoSQL. Sposób działania optymalizatora dla MongoDB możemy znaleźć na stronie: <a href="https://www.mongodb.com/docs/manual/core/query-plans/">https://www.mongodb.com/docs/manual/core/query-plans/</a>. W znakomitej większości przypadków optymalizatory są dużym ułatwieniem dla programistów, którzy nie muszą poświęcać czasu na analizę rozkładu danych w poszczególnych tabelach/kolekcjach i samodzielną optymalizację wykonywanych zapytań. Ponieważ optymalizator działa bez kontroli programisty, zdarzają się sytuacje, w których jego zachowanie jest dla nas zaskakujące i może prowadzić do problemów wydajnościowych.</p>

<h2 id="analiza-problemów-wydajnościowych">Analiza problemów wydajnościowych</h2>

<p>Jeżeli mamy podejrzenie, że problemy z wydajnością naszego systemu mogą być związane z bazą MongoDB istnieje dość prosty sposób, który pozwala na potwierdzenie lub wykluczenie takiej tezy. Należy mianowicie ustawić próg czasowy, przy którym MongoDB będzie logowało przekraczające go zapytania:
<a href="https://www.mongodb.com/docs/manual/reference/configuration-options/#mongodb-setting-operationProfiling.slowOpThresholdMs">https://www.mongodb.com/docs/manual/reference/configuration-options/#mongodb-setting-operationProfiling.slowOpThresholdMs</a>.</p>

<p>W analizowanym przez nas przypadku w logu diagnostycznym znajdowało się wiele wpisów, których czas wykonania przekraczał 10 sekund:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2023-10-01T14:50:35.652+0100 I COMMAND  [conn121] command formstore_db.formModel command: find { find: "formModel", readConcern: { level: "majority" }, filter: { formFields.formInstanceNumber.value: { $in: [ "EXI123456789", (...) "EXI987654321" ] }, formType: "some_form" }, sort: { _id: -1 }, projection: { formType: 1, (...) lastUpdateTime: 1 }, $db: "formstore_db", $clusterTime: { clusterTime: Timestamp(1671457810, 3), signature: { hash: BinData(0, 9A2225836AC174D40666995D6954154960FE67DB), keyId: 7137070794986749953 } }, lsid: { id: UUID("36e6cf62-4ad2-4b34-8a56-227d283da075") } } planSummary: IXSCAN { _id: 1 } keysExamined:254713 docsExamined:254713 fromMultiPlanner:1 replanned:1 cursorExhausted:1 numYields:2213 nreturned:75 reslen:289780 locks:{ Global: { acquireCount: { r: 2214 } }, Database: { acquireCount: { r: 2214 } }, Collection: { acquireCount: { r: 2214 } } } storage:{ data: { bytesRead: 15335932371, timeReadingMicros: 10566758 }, timeWaitingMicros: { cache: 56 } } protocol:op_msg 11597ms
</code></pre></div></div>
<p>Linijka logu jest dość długa. Na jej końcu mamy podany czas wykonania zapytania: <code class="language-plaintext highlighter-rouge">protocol:op_msg 11597ms</code>. Czas wykonania zdecydowanie przekraczał oczekiwaną wartość, co pozwoliło potwierdzić tezę, że przyczyna problemów wydajnościowych leży po stronie bazy danych. Warto zwrócić jeszcze uwagę na następującą informację w logu:</p>

<p><code class="language-plaintext highlighter-rouge">planSummary: IXSCAN { _id: 1 } keysExamined:254713 docsExamined:254713</code>.</p>

<p>Wskazuje ona na to, że użyty został standardowy indeks MongoDB zakładany na identyfikatorze kolekcji <code class="language-plaintext highlighter-rouge">_id</code>. Oczekiwaliśmy tutaj raczej użycia indeksu założonego na polu, po którym odbywało się filtrowanie czyli na <code class="language-plaintext highlighter-rouge">formFields.formInstanceNumber.value</code>. W takim przypadku pierwsze podejrzenie padło na możliwy brak indeksu. W celu potwierdzenia lub zaprzeczenia tej możliwości pobraliśmy indeksy założone na problematycznej kolekcji: <code class="language-plaintext highlighter-rouge">db.formModel.getIndexes();</code>. Odpowiedź wskazywała jednak, że wymagany indeks został założony:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formstore_db.formModel</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">v</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">key</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">ns</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formstore_db.formModel</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">background</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<h2 id="sprawdzamy-plan-zapytania">Sprawdzamy plan zapytania</h2>

<p>W takim przypadku warto przeprowadzić analizę planu zapytania. Co ważne, analizę należy przeprowadzić na środowisku, na którym wystąpiły problemy, gdyż wyniki pracy optymalizatora są zależne od danych znajdujących się w bazie oraz statystyk zbieranych podczas jej działania. Wyświetlenie wybranego planu zapytania oraz planów alternatywnych realizujemy poprzez wywołanie zapytania wykonywanego przez aplikację, w którym na końcu dodajemy: <code class="language-plaintext highlighter-rouge">.explain("allPlansExecution")</code>. W analizowanym przypadku otrzymaliśmy następujący wynik:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">queryPlanner</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">plannerVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">namespace</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formstore_db.formModel</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexFilterSet</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">parsedQuery</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
              <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
              <span class="c1">// ...</span>
              <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">winningPlan</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="c1">// ...</span>
        <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">$and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
                  <span class="c1">// ...</span>
                  <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
                <span class="p">]</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">backward</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
              <span class="dl">"</span><span class="s2">[MaxKey, MinKey]</span><span class="dl">"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">rejectedPlans</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="c1">// ...</span>
          <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">sortPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT_KEY_GENERATOR</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">},</span>
                <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
                <span class="p">},</span>
                <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span><span class="p">,</span>
                    <span class="c1">// ...</span>
                    <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span>
                  <span class="p">]</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="c1">// ...</span>
          <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">sortPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT_KEY_GENERATOR</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
                    <span class="c1">// ...</span>
                    <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
                  <span class="p">]</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">},</span>
                <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formType_1</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
                <span class="p">},</span>
                <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">some_form</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">some_form</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span>
                  <span class="p">]</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">executionSuccess</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">executionTimeMillis</span><span class="dl">"</span><span class="p">:</span> <span class="mi">11651</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">executionStages</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">10335</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254852</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254776</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="c1">// ...</span>
        <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">$and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
                  <span class="c1">// ...</span>
                  <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
                <span class="p">]</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">10325</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254852</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254776</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">docsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">alreadyHasObj</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254852</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">backward</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
              <span class="dl">"</span><span class="s2">[MaxKey, MinKey]</span><span class="dl">"</span>
            <span class="p">]</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">keysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">seeks</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">dupsTested</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">dupsDropped</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">seenInvalidated</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">allPlansExecution</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3640</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionStages</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3640</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76380</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">817</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">817</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1">// ...</span>
            <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">$and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                      <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
                      <span class="c1">// ...</span>
                      <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
                    <span class="p">]</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">]</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3640</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76380</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">817</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">817</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">docsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">alreadyHasObj</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">817</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">817</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">backward</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="dl">"</span><span class="s2">[MaxKey, MinKey]</span><span class="dl">"</span>
                <span class="p">]</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">keysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">76455</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">seeks</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">dupsTested</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">dupsDropped</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">seenInvalidated</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionStages</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1">// ...</span>
            <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">sortPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">memUsage</span><span class="dl">"</span><span class="p">:</span> <span class="mi">33914115</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">memLimit</span><span class="dl">"</span><span class="p">:</span> <span class="mi">33554432</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT_KEY_GENERATOR</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">docsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">alreadyHasObj</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
                  <span class="p">},</span>
                  <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
                  <span class="p">},</span>
                  <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                      <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span><span class="p">,</span>
                      <span class="c1">// ...</span>
                      <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span>
                    <span class="p">]</span>
                  <span class="p">},</span>
                  <span class="dl">"</span><span class="s2">keysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">seeks</span><span class="dl">"</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">dupsTested</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">dupsDropped</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">seenInvalidated</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionStages</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27872</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27871</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1">// ...</span>
            <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
          <span class="p">},</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27872</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27871</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">sortPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">memUsage</span><span class="dl">"</span><span class="p">:</span> <span class="mi">33914115</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">memLimit</span><span class="dl">"</span><span class="p">:</span> <span class="mi">33554432</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT_KEY_GENERATOR</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1190</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27871</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27796</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                      <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
                      <span class="c1">// ...</span>
                      <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
                    <span class="p">]</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1180</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27795</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">docsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">alreadyHasObj</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2212</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
                  <span class="p">},</span>
                  <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formType_1</span><span class="dl">"</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
                  <span class="p">},</span>
                  <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                      <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">some_form</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">some_form</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span>
                    <span class="p">]</span>
                  <span class="p">},</span>
                  <span class="dl">"</span><span class="s2">keysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27870</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">seeks</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">dupsTested</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">dupsDropped</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="dl">"</span><span class="s2">seenInvalidated</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">serverInfo</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">examplehost1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">4.0.9</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">gitVersion</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fc525e2d9b0e4bceff5c2201457e564362909765</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">operationTime</span><span class="dl">"</span><span class="p">:</span> <span class="nx">Timestamp</span><span class="p">(</span><span class="mi">1671465640</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">$clusterTime</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">clusterTime</span><span class="dl">"</span><span class="p">:</span> <span class="nx">Timestamp</span><span class="p">(</span><span class="mi">1671465640</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">hash</span><span class="dl">"</span><span class="p">:</span> <span class="nx">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">AAAAAAAAAAAAAAAAAAAAAAAAAAA=</span><span class="dl">"</span><span class="p">),</span>
      <span class="dl">"</span><span class="s2">keyId</span><span class="dl">"</span><span class="p">:</span> <span class="nx">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Wynik analizy jest dość obszerny, jednak można go podsumować tak:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">winningPlan</code> czyli plan, który został wykonany posłużył się standardowym indeksem kolekcji:
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">_id_</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">backward</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">[MaxKey, MinKey]
      ]
    }
  }
}
</span></code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">rejectedPlans</code> czyli plany odrzucone zawierają plan wykorzystujący indeks, który naszym zdaniem powinien zostać użyty:
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>Co więcej, plan który został wybrany odwiedził 254851 dokumentów i kluczy, a zapytanie trwało 11651 ms:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">executionSuccess</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">executionTimeMillis</span><span class="dl">"</span><span class="p">:</span> <span class="mi">11651</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">254851</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>Przy czym jeden z planów odrzuconych mógł zwrócić wynik po odwiedzeniu 75 dokumentów i 135 kluczy, a jego wykonanie szacowane było na 30 ms:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="dlaczego-mongodb-nie-używa-indeksu">Dlaczego MongoDB nie używa indeksu</h2>

<p>W tym miejscu należy się zastanowić w jaki sposób MongoDB wybiera najlepszy plan zapytania. Z pierwszego punktu tego wpisu wiemy, że optymalizator bazuje na statystykach zbieranych podczas działania bazy. Potrzebujemy jeszcze wiedzieć w jaki sposób budowane są te statystyki. W opisywanym przypadku to właśnie tutaj kryje się rozwiązanie naszego problemu.</p>

<p>Optymalizator MongoDB cache’uje plany zapytań. Plan zapytania, który wygrał (<code class="language-plaintext highlighter-rouge">winningPlan</code>) trafia do cache’a i po kolejnym zapytaniu, w którym okazał się planem wygrywającym staje się aktywny. Następne zapytanie o takim samym <strong>kształcie</strong> zostaje wykonane w oparciu o aktywny plan z cache’a. Algorytm wygląda tak:</p>

<div class="img-with-legend">
<img alt="Algorytm optymalizatora" src="/assets/img/posts/2023-10-24-jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu/query-planner-logic.bakedsvg.svg" />
<span class="img-legend">Źródło: <a href="https://www.mongodb.com/docs/manual/core/query-plans/">www.mongodb.com</a> - dostęp: 2023-10-17</span>
</div>

<p>Kluczem w cachu planów zapytań jest kształt zapytania <a href="https://www.mongodb.com/docs/manual/reference/glossary/#std-term-query-shape">query-shape</a>. Na kształt zapytania składają się:</p>
<ul>
  <li>predykat zapytania (czyli to po czym filtrujemy kolekcję),</li>
  <li>projekcja,</li>
  <li>sposób sortowania,</li>
  <li><a href="https://www.mongodb.com/docs/manual/reference/collation/#std-label-collation">collation</a>.</li>
</ul>

<p>Uzbrojeni w tę wiedzę przeanalizowaliśmy jakie zapytania kieruje do MongoDB nasza aplikacja. Okazało się, że w większości przypadków aplikacja odpytuje bazę o pojedynczą wartość pola <code class="language-plaintext highlighter-rouge">formFields.formInstanceNumber.value</code>. Tak więc w klauzuli <code class="language-plaintext highlighter-rouge">in</code> znajduje się jedna wartość. Dla takiej postaci zapytania optymalizator wybierał plan, który nie uwzględniał oczekiwanego przez nas indeksu. Taki plan trafiał do cache’a planów zapytań. Od czasu do czasu zdarzał się jednak klient systemu, dla którego zapytanie zawierało wiele wartości w klauzuli <code class="language-plaintext highlighter-rouge">in</code>. Kształt zapytania pozostawał ten sam więc MongoDB nadal używało planu, który znajdował się w cache’u. W ten sposób, dla klienta, który używał systemu w szerszym zakresie niż pozostali dostawaliśmy timeout. Rozwiązaniem tego problemu mogłoby być takie dobranie zapytań, aby klienci z pojedynczą wartością w klauzuli <code class="language-plaintext highlighter-rouge">in</code> posługiwali się innym kształtem zapytania niż klienci z wieloma wartościami. To wymagałoby jednak zmiany w kodach systemu.</p>

<h2 id="wymuszenie-użycia-indeksu-na-podczas-pracy-bazy">Wymuszenie użycia indeksu na podczas pracy bazy</h2>

<p>MongoDB daje nam jednak możliwość na wymuszenie użycia indeksu dla określonego kształtu zapytania. Taką konfigurację można zastosować na działającym systemie i działa ona natychmiast. Należy użyć polecenia: <code class="language-plaintext highlighter-rouge">planCacheSetFilter</code>. W naszej sytuacji użyliśmy następującej komendy:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">({</span>
  <span class="na">planCacheSetFilter</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formModel</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">query</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
          <span class="c1">// ...</span>
          <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
    <span class="p">},</span>      
    <span class="na">projection</span> <span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="c1">// ...</span>
      <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="na">sort</span> <span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">},</span>
    <span class="na">indexes</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">})</span>
</code></pre></div></div>
<p>W ten sposób wymuszamy na MongoDB używanie indeksu na polu <code class="language-plaintext highlighter-rouge">formFields.formInstanceNumber.value</code> w zapytaniach o podanym kształcie. Być może zapytania dla pojedynczych wartości będą trochę mniej optymalne, ale za to dużo szybciej wykonają się zapytania dla dużej liczby wartości w klauzuli <code class="language-plaintext highlighter-rouge">in</code>.</p>

<p><strong>Uwaga! Zmiana ta działa do czasu restartu MongoDB</strong>, nie jest więc docelowym rozwiązaniem, ale daje czas na uzyskanie satysfakcjonującego rozwiązania w kodzie.</p>

<p>Po ponowieniu zapytania otrzymaliśmy następujący wynik:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">queryPlanner</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">plannerVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">namespace</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formstore_db.formModel</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">indexFilterSet</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">parsedQuery</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">$and</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">$in</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
              <span class="dl">"</span><span class="s2">EXI123456789</span><span class="dl">"</span><span class="p">,</span>
              <span class="c1">// ...</span>
              <span class="dl">"</span><span class="s2">EXI987654321</span><span class="dl">"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">winningPlan</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="c1">// ...</span>
        <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">sortPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT_KEY_GENERATOR</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span><span class="p">,</span>
                  <span class="c1">// ...</span>
                  <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span>
                <span class="p">]</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">rejectedPlans</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">executionSuccess</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">executionTimeMillis</span><span class="dl">"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">executionStages</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PROJECTION</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">213</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">transformBy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="c1">// ...</span>
        <span class="dl">"</span><span class="s2">lastUpdateTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">213</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">sortPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">_id</span><span class="dl">"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">},</span>
        <span class="dl">"</span><span class="s2">memUsage</span><span class="dl">"</span><span class="p">:</span> <span class="mi">33914115</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">memLimit</span><span class="dl">"</span><span class="p">:</span> <span class="mi">335544320</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SORT_KEY_GENERATOR</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">FETCH</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">filter</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">formType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">$eq</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">some_form</span><span class="dl">"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">docsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">alreadyHasObj</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">executionTimeMillisEstimate</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">works</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">advanced</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needTime</span><span class="dl">"</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">needYield</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">saveState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">restoreState</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isEOF</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">invalidates</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">indexBounds</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI123456789</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span><span class="p">,</span>
                  <span class="c1">// ...</span>
                  <span class="dl">"</span><span class="s2">[</span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">EXI987654321</span><span class="se">\"</span><span class="s2">]</span><span class="dl">"</span>
                <span class="p">]</span>
              <span class="p">},</span>
              <span class="dl">"</span><span class="s2">keysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">seeks</span><span class="dl">"</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">dupsTested</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">dupsDropped</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">seenInvalidated</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">allPlansExecution</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">serverInfo</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">examplehost1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">27017</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">4.0.9</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">gitVersion</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fc525e2d9b0e4bceff5c2201457e564362909765</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">operationTime</span><span class="dl">"</span><span class="p">:</span> <span class="nx">Timestamp</span><span class="p">(</span><span class="mi">1671537181</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">$clusterTime</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">clusterTime</span><span class="dl">"</span><span class="p">:</span> <span class="nx">Timestamp</span><span class="p">(</span><span class="mi">1671537181</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">hash</span><span class="dl">"</span><span class="p">:</span> <span class="nx">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">AAAAAAAAAAAAAAAAAAAAAAAAAAA=</span><span class="dl">"</span><span class="p">),</span>
      <span class="dl">"</span><span class="s2">keyId</span><span class="dl">"</span><span class="p">:</span> <span class="nx">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Widać że <code class="language-plaintext highlighter-rouge">winningPlan</code> używa wskazanego przez nas indeksu:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">inputStage</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">stage</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">IXSCAN</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">keyPattern</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">indexName</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value_1</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">isMultiKey</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">multiKeyPaths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">formFields.formInstanceNumber.value</span><span class="dl">"</span><span class="p">:</span> <span class="p">[]</span>
      <span class="p">},</span>
      <span class="dl">"</span><span class="s2">isUnique</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">isSparse</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">isPartial</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">indexVersion</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">direction</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">forward</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>a wykonanie zapytania trwało 10 milisekund. Podczas przetwarzania zapytania odwiedzonych zostało 136 kluczy i 75 dokumentów:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{</span>
    <span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">executionSuccess</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">nReturned</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">executionTimeMillis</span><span class="dl">"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalKeysExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">totalDocsExamined</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<h2 id="wnioski">Wnioski</h2>

<p>Oczywisty wniosek płynący z przedstawionej tutaj sytuacji jest taki, że musimy brać pod uwagę to, że MongoDB nie musi używać utworzonego przez nas indeksu. Szczególną uwagę powinniśmy zwrócić na zapytania, które są uruchamiane ze znacząco różnymi zakresami danych wejściowych.</p>

<p>Wniosek mniej oczywisty jest związany z użyciem circuit breakera. W naszym przypadku circuit breaker odcinał wykonywanie zapytań trwających dłużej niż 10 sekund. Ponieważ klienci, dla których w klauzuli <code class="language-plaintext highlighter-rouge">in</code> wykorzystywaliśmy dużo wartości ponawiali próby wywołania funkcjonalności, circuit breaker wyłączył wywoływanie tej funkcjonalności. To spowodowało, że również dla klientów z mniejszą liczbą wartości w klauzuli <code class="language-plaintext highlighter-rouge">in</code> funkcjonalność stała się niedostępna.</p>

<h2 id="tldr">tl;dr</h2>

<ol>
  <li>Jeżeli używasz MongoDB włącz <a href="https://www.mongodb.com/docs/manual/reference/configuration-options/#mongodb-setting-operationProfiling.slowOpThresholdMs">logowanie długich zapytań</a>.</li>
  <li>W przypadku problemów wydajnościowych z zapytaniem sprawdź plan wykonania zapytania dodając do polecenia <code class="language-plaintext highlighter-rouge">.explain("allPlansExecution")</code>.</li>
  <li>Jeżeli chcesz wymusić, aby MongoDB używało indeksu w określonym zapytaniu można to osiągnąć bez przerwy w pracy systemu za pomocą polecenia <code class="language-plaintext highlighter-rouge">planCacheSetFilter</code>.</li>
</ol>

<h1 id="źródła">Źródła</h1>

<ul>
  <li><a href="https://www.mongodb.com/docs/manual/core/query-plans/">Opis działania optymalizatora zapytań w MongoDB</a>.</li>
  <li><a href="https://www.mongodb.com/docs/manual/reference/configuration-options/#mongodb-setting-operationProfiling.slowOpThresholdMs">Sposób na logowanie długich zapytań w MongoDB</a>.</li>
  <li><a href="https://www.mongodb.com/docs/manual/reference/command/planCacheSetFilter/">Polecenie umożliwiające wymuszenie użycia określonego indeksu dla zapytania o podanym kształcie</a></li>
  <li><a href="https://www.mongodb.com/docs/manual/reference/glossary/#std-term-query-shape">Wyjaśnienie czym jest kształt zapytania <code class="language-plaintext highlighter-rouge">query-shape</code></a></li>
</ul>


                    
                    
                    
                </div>
            </div>
            <div class="sidebar">
                
<div class="sidebar-container">
    <div class="sidebar-title">
        Newest posts
    </div>
    <div class="sidebar-latest-posts-container">
        <ul class="sidebar-posts"><li class="sidebar-post no-breaking-word">
                <a href="/en/2021/09/13/kafka-retry-dlq.html" lang="pl">Reliable event delivery in Apache Kafka based on retry and DLQ</a>
            </li><li class="sidebar-post no-breaking-word">
                <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html" lang="pl">Event Tracking - finding a needle in a haystack</a>
            </li><li class="sidebar-post no-breaking-word">
                <a href="/en/2021/08/30/kouncil-introduction.html" lang="pl">Kouncil - a modern Kafka frontend</a>
            </li></ul>
    </div>
</div>

                <div class="sidebar-container" id="recommended-posts-sidebar">
    <div class="sidebar-title">
        Podobne wpisy
    </div>
    <div class="sidebar-latest-posts-container">
        <ul class="sidebar-posts" id="recommended-posts-desktop">

        </ul>
    </div>
</div>

                <div class="sidebar-container" id="recommended-posts-sidebar">
    <div class="sidebar-title">
        Dołącz do nas
    </div>
    <div class="sidebar-last-posts-container">
        <ul class="sidebar-posts">
            <li class="sidebar-post no-breaking-word">
                <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/senior-fullstack-developer-java-angular"
                   lang="pl">
                    <div class="job-offer">
                        <span class="job-title">SENIOR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                        <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                        <span class="job-salary">
                            UoP 14 900 - 20 590 PLN brutto <br/>
                            B2B 19 680 - 27 220 PLN netto
                        </span>
                    </div>
                </a>
            </li>
            <li class="sidebar-post no-breaking-word">
                <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/regular-fullstack-developer-java-angular"
                   lang="pl">
                    <div class="job-offer">
                        <span class="job-title">REGULAR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                        <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                        <span class="job-salary">
                            UoP 11 300 - 15 900 PLN brutto <br/>
                            B2B 14 950 - 21 000 PLN netto
                        </span>
                    </div>
                </a>
            </li>
            <li class="sidebar-post no-breaking-word">
                <a class="clickable-offer" href="https://www.consdata.com/pl/kariera/trwajace-rekrutacje#tag-developer">
                    <div class="other-job-offers">
                        <span class="job-title">ZOBACZ WSZYSTKIE OGŁOSZENIA</span>
                    </div>
                </a>
            </li>
        </ul>
    </div>
</div>

            </div>
        </div>
        <div class="post-post-section-mobile">
            
<div class="sidebar-container">
    <div class="sidebar-title">
        Newest posts
    </div>
    <div class="sidebar-latest-posts-container">
        <ul class="sidebar-posts"><li class="sidebar-post no-breaking-word">
                <a href="/en/2021/09/13/kafka-retry-dlq.html" lang="pl">Reliable event delivery in Apache Kafka based on retry and DLQ</a>
            </li><li class="sidebar-post no-breaking-word">
                <a href="/en/2021/09/08/kouncil-event-tracking-kafka.html" lang="pl">Event Tracking - finding a needle in a haystack</a>
            </li><li class="sidebar-post no-breaking-word">
                <a href="/en/2021/08/30/kouncil-introduction.html" lang="pl">Kouncil - a modern Kafka frontend</a>
            </li></ul>
    </div>
</div>

        </div>
        <div class="post-post-section-mobile">
            <div class="sidebar-container" id="recommended-posts-bottombar">
    <div class="sidebar-title">
        Podobne wpisy
    </div>
    <div class="sidebar-latest-posts-container">
        <ul class="sidebar-posts" id="recommended-posts-mobile">

        </ul>
    </div>
</div>

        </div>
        <div class="post-post-section-mobile">
            <div class="sidebar-container" id="recommended-posts-sidebar">
    <div class="sidebar-title">
        Dołącz do nas
    </div>
    <div class="sidebar-last-posts-container">
        <ul class="sidebar-posts">
            <li class="sidebar-post no-breaking-word">
                <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/senior-fullstack-developer-java-angular"
                   lang="pl">
                    <div class="job-offer">
                        <span class="job-title">SENIOR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                        <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                        <span class="job-salary">
                            UoP 14 900 - 20 590 PLN brutto <br/>
                            B2B 19 680 - 27 220 PLN netto
                        </span>
                    </div>
                </a>
            </li>
            <li class="sidebar-post no-breaking-word">
                <a href="https://consdata.com/pl/kariera/trwajace-rekrutacje/poznan/regular-fullstack-developer-java-angular"
                   lang="pl">
                    <div class="job-offer">
                        <span class="job-title">REGULAR FULLSTACK DEVELOPER (JAVA + ANGULAR)</span>
                        <span class="job-description">Poznań (hybrydowo) lub zdalnie</span>
                        <span class="job-salary">
                            UoP 11 300 - 15 900 PLN brutto <br/>
                            B2B 14 950 - 21 000 PLN netto
                        </span>
                    </div>
                </a>
            </li>
            <li class="sidebar-post no-breaking-word">
                <a class="clickable-offer" href="https://www.consdata.com/pl/kariera/trwajace-rekrutacje#tag-developer">
                    <div class="other-job-offers">
                        <span class="job-title">ZOBACZ WSZYSTKIE OGŁOSZENIA</span>
                    </div>
                </a>
            </li>
        </ul>
    </div>
</div>

        </div>
        <div class="author-bio">
    
    <div class="author-image">
        <a href="/en/authors/jwilczewski.html" class="author-name">
            <img src="/assets/img/authors/jwilczewski.jpg" alt="author" width="120" height="120">
        </a>
    </div>
    
    <div class="card">
        <div class="header">
            
            <a href="/en/authors/jwilczewski.html" class="author-name">
                Jakub Wilczewski
            </a>
            
            <div class="social-buttons">
                
                <div class="author-github">
                    <a href="https://github.com/jwilczewski"
                       title="jwilczewski">
                        <svg class="svg-icon grey">
                            <use xlink:href="/assets/minima-social-icons.svg#github"></use>
                        </svg>
                        jwilczewski</a>
                </div>
                
            </div>
        </div>
        <div class="content">
            
                
                    <div class="bio"></div>
                
            
        </div>
    </div>
</div>
<div class="author-bio-mobile">
    <div class="header">
        
        <div class="author-image">
            <img src="/assets/img/authors/jwilczewski.jpg">
        </div>
        
        <div class="name-wrapper">
            
            <div class="author-name">Jakub Wilczewski</div>
            
            <div class="social-buttons">
                
                <div class="author-github">
                    <a href="https://github.com/jwilczewski"
                       title="jwilczewski">
                        <svg class="svg-icon grey">
                            <use xlink:href="/assets/minima-social-icons.svg#github"></use>
                        </svg>
                        jwilczewski</a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="content">
        
            
            
                <div class="bio">Developer głównie backendu. Pasjonat działających systemów i zwolennik metodyki devops. Zdeklarowany przeciwnik ciężkich serwerów aplikacji. Ostatnimi czasy intensywnie rozwija umiejętności w zakresie clouda. W czasie wolnym od pracy i obowiązków domowych biega po płaskim i łazi po górach.</div>
            
        
    </div>
</div>
<div id="disqus_thread"></div>
<script>
    function readCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    if (readCookie('cookie-notice-dismissed') === 'true') {
        var disqus_config = function () {
            this.page.url = 'https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html';
            this.page.identifier = 'https://blog.consdata.tech/2023/10/24/jak-zmusic-mongodb-do-uzycia-indeksu-bez-zmiany-kodu.html';
        };

        (function () {
            var d = document, s = d.createElement('script');

            s.src = 'https://consdata-tech.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    }
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
    powered by Disqus.</a></noscript></article>
</div>
<script>
    const language = 'en';
    const jsonPath = language === 'en' ? '/en/json/posts.json' : '/json/posts.json';
    fetch(jsonPath)
        .then(response => response.json())
        .then(store => {
            function displayResults(results) {
                if (results.length > 0) {
                    const container = document.getElementById("recommended-posts-desktop");
                    const containerMobile = document.getElementById("recommended-posts-mobile");
                    results
                        .forEach(result => {
                            const item = store[result.ref];
                            if (item.lang === language) {
                                const listElement = document.createElement('li');
                                const anchor = document.createElement('a');
                                const postTitle = document.createTextNode(item.title);
                                listElement.classList.add('sidebar-post');
                                listElement.classList.add('no-breaking-word');
                                anchor.setAttribute('href', item.url);
                                anchor.setAttribute('lang', 'pl');
                                anchor.appendChild(postTitle);
                                listElement.appendChild(anchor);
                                container.appendChild(listElement);
                                containerMobile.appendChild(listElement.cloneNode(true));
                            }
                        });
                    if (container.children.length < 1) {
                        hideRecommendedPosts();
                    }
                } else {
                    hideRecommendedPosts();
                }

            }

            const tags = "mongodb index planCacheSetFilter index filter query shape";
            const idx = lunr(function () {
                this.field('tags');

                for (let key in store) {
                    this.add({
                        'id': key,
                        'title': store[key].title,
                        'tags': store[key].tags,
                    });
                }
            });
            const results = idx.search(tags).slice(1, 4);
            displayResults(results);
        })

    function zoomImage($event) {
        const modal = document.getElementById('myModal');
        modal.getElementsByTagName('img')[0].src = $event.target.src;
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }

    function hideRecommendedPosts() {
        document.getElementById("recommended-posts-sidebar").style.display = 'none';
        document.getElementById("recommended-posts-bottombar").style.display = 'none';
    }

    const postImages = document.querySelectorAll('.post-content img');
    postImages.forEach(x => x.addEventListener('click', zoomImage));
</script>

</main><footer>
    <div class="container">
        <div class="footer-item company">
            <div class="label">
                <img src="/assets/img/logo.png"/>
            </div>
            <div class="item-content">
                <p>
                    K9OFFICE, UL. KRYSIEWICZA 9/17<br/>
                    61-825 POZNAŃ<br/>
                    POLSKA
                </p>
                <p>
                    TEL.:+48 61 41 51 000
                </p>
                <p>
                    NIP: 1822261960<br/>
                    REGON: 634422180
                </p>
            </div>
        </div>
        <div class="footer-item legals">
            <div class="label">
                INFORMATION
            </div>
            <div class="item-content">
                <p>
                    <a href="https://consdata.com/pl/polityka-prywatnosci" target="_blank">PRIVACY POLICY </a>
                </p>
            </div>
        </div>
        <div class="footer-item social-buttons">
            <div class="label">
                STAY IN TOUCH
            </div>
            <div class="item-content">
                <div class="social-buttons-container">
                    <div class="social-button-wrapper">
                        <a class="social-btn" target="_blank" href="https://www.facebook.com/consdatacom"
                           title="Facebook">
                            <i class="fa fa-facebook"></i>
                        </a>
                    </div>
                    <div class="social-button-wrapper">
                        <a class="social-btn" target="_blank"
                           href="https://www.youtube.com/channel/UCv4d_uCiLdDkOFk8NtDsU_w" title="Youtube">
                            <i class="fa fa-youtube"></i>
                        </a>
                    </div>
                    <div class="social-button-wrapper">
                        <a class="social-btn" target="_blank" href="https://www.linkedin.com/company/1456906"
                           title="Linkedin">
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright">
        Copyrights © 2024 CONSDATA
    </div>
</footer>
<div class="cookie-notice" id="cookie-notice">
    <span>
        
        Chcemy używać plików cookie oraz skryptów podmiotów trzecich do polepszania funkcjonowania tej strony
    </span>
    <a id="cookie-notice-accept" class="consent-button">Zgadzam się</a>
    <i onclick="hideConsent()" class="close-consent fa fa-times close"></i>
    <noscript><img height="1" width="1" style="display:none"
                   src="https://www.facebook.com/tr?id=300808861525851&ev=PageView&noscript=1"
    /></noscript>
</div>

<script>
    function createCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    function readCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function eraseCookie(name) {
        createCookie(name, "", -1);
    }

    function hideConsent() {
        document.getElementById('cookie-notice').style.display = 'none';
    }

    if (readCookie('cookie-notice-dismissed') === 'true') {!function (f, b, e, v, n, t, s) {
    if (f.fbq) return;
    n = f.fbq = function () {
        n.callMethod ?
            n.callMethod.apply(n, arguments) : n.queue.push(arguments)
    };
    if (!f._fbq) f._fbq = n;
    n.push = n;
    n.loaded = !0;
    n.version = '2.0';
    n.queue = [];
    t = b.createElement(e);
    t.async = !0;
    t.src = v;
    s = b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t, s)
}(window, document, 'script',
    'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '300808861525851');
fbq('track', 'PageView');
} else {
        document.getElementById('cookie-notice').style.display = 'flex';
    }

    document.getElementById('cookie-notice-accept').addEventListener("click", function () {
        createCookie('cookie-notice-dismissed', 'true', 31);
        hideConsent();
        location.reload();
    });
</script>

</body>
</html>
